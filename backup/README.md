# راهنمای تنظیم بک‌آپ خودکار

## پیش‌نیازها
1. داشتن یک حساب Google
2. نصب rclone روی سیستم شخصی

## مراحل تنظیم Google Drive

### 1. ایجاد OAuth 2.0 Client ID در Google Cloud Console
1. به [Google Cloud Console](https://console.cloud.google.com/) بروید
2. یک پروژه جدید ایجاد کنید یا پروژه موجود را انتخاب کنید
3. به بخش "APIs & Services > Credentials" بروید
4. روی "Create Credentials" کلیک کنید و "OAuth client ID" را انتخاب کنید
5. نوع اپلیکیشن را "Desktop app" انتخاب کنید
6. یک نام برای آن وارد کنید (مثلاً "CRM Backup")
7. Client ID و Client Secret را ذخیره کنید

### 2. تنظیم rclone
1. دستور زیر را در ترمینال اجرا کنید:
```bash
rclone config
```
2. گزینه "n" را برای ایجاد remote جدید انتخاب کنید
3. نام remote را "gdrive" وارد کنید
4. در لیست سرویس‌ها، شماره مربوط به "Google Drive" را انتخاب کنید
5. client_id و client_secret که از مرحله قبل دریافت کردید را وارد کنید
6. سایر تنظیمات را با مقادیر پیش‌فرض قبول کنید
7. در مرحله احراز هویت، لینکی به شما داده می‌شود. آن را در مرورگر باز کنید و اجازه دسترسی را تأیید کنید
8. کد تأیید را در ترمینال وارد کنید
9. تنظیمات را تأیید کنید

### 3. کپی کردن فایل پیکربندی
پس از تنظیم rclone، فایل پیکربندی را به پوشه پروژه کپی کنید:
```bash
cp ~/.config/rclone/rclone.conf ./backup/
```

### 4. راه‌اندازی مجدد سرویس‌های داکر
```bash
docker-compose down
docker-compose up -d
```

## نکات مهم
- بک‌آپ‌ها هر 24 ساعت یکبار گرفته می‌شوند
- بک‌آپ‌ها به مدت 30 روز نگهداری می‌شوند
- بک‌آپ‌ها در پوشه "crm-backups" در Google Drive شما ذخیره می‌شوند
- اولین بک‌آپ بلافاصله پس از راه‌اندازی سرویس انجام می‌شود

## بازیابی بک‌آپ
برای بازیابی یک بک‌آپ:
1. فایل مورد نظر را از Google Drive دانلود کنید
2. از حالت فشرده خارج کنید:
```bash
gunzip backup_file.sql.gz
```
3. بک‌آپ را بازیابی کنید:
```bash
mysql -h mysql -uroot -p1234 crm_system < backup_file.sql
```
